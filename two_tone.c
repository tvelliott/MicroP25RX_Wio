#include "two_tone.h"

static const two_tone_table two_tones[] = {
  1, 283.0f,    //265.7 - 296.8
  2, 310.75f,   //296.9 - 328.1
  3, 344.25f,   //328.2 - 359.3
  4, 376.25f,   //359.4 - 390.6
  5, 407.5f,    //390.7 - 421.8
  6, 435.25f,   //421.9 - 453.1
  7, 467.25f,   //453.2 - 484.3
  8, 496.25f,   //484.4 - 515.6
  9, 528.5f,    //515.7 - 546.8
  10, 566.0f,   //546.9 - 578.1
  11, 598.0f,   //578.2 - 609.3
  12, 621.5f,   //609.4 - 640.6
  13, 660.0f,   //640.7 - 671.8
  14, 688.25f,  //671.9 - 703.1
  15, 719.0f,   //703.2 - 734.3
  16, 752.5f,   //734.4 - 765.6
  17, 789.75f,  //765.7 - 796.8
  18, 806.25f,  //796.9 - 828.1
  19, 849.0f,   //828.2 - 859.3
  20, 880.5f,   //859.4 - 890.6
  21, 914.25f,  //890.7 - 921.8
  22, 932.0f,   //921.9 - 953.1
  23, 970.0f,   //953.2 - 984.3
  24, 1011.0f,  //984.4 - 1015.6
  25, 1032.5f,  //1015.7 - 1046.8
  26, 1055.0f,  //1046.9 - 1078.1
  27, 1103.0f,  //1078.2 - 1109.3
  28, 1128.75f, //1109.4 - 1140.6
  29, 1155.75f, //1140.7 - 1171.8
  30, 1184.5f,  //1171.9 - 1203.1
  31, 1219.0f,  //1203.2 - 1234.3
  32, 1242.75f, //1234.4 - 1265.6
  33, 1293.25f, //1265.7 - 1296.8
  34, 1320.0f,  //1296.9 - 1328.1
  35, 1347.75f, //1328.2 - 1359.3
  36, 1376.75f, //1359.4 - 1390.6
  37, 1406.5f,  //1390.7 - 1421.8
  38, 1437.75f, //1421.9 - 1453.1
  39, 1470.5f,  //1453.2 - 1484.3
  40, 1505.0f,  //1484.4 - 1515.6
  41, 1541.25f, //1515.7 - 1546.8
  42, 1579.25f, //1546.9 - 1609.3
  43, 1616.75f, //1609.4 - 1640.6
  44, 1650.0f,  //1640.7 - 1671.8
  45, 1684.75f, //1671.9 - 1703.1
  46, 1721.0f,  //1703.2 - 1734.3
  47, 1758.25f, //1734.4 - 1765.6
  48, 1797.25f, //1765.7 - 1828.1
  49, 1838.25f, //1828.2 - 1859.3
  50, 1881.25f, //1859.4 - 1890.6
  51, 1926.5f,  //1890.7 - 1953.1
  52, 1974.0f,  //1953.2 - 2015.6
  53, 2021.75f, //2015.7 - 2046.8
  54, 2065.0f,  //2046.9 - 2078.1
  55, 2110.0f,  //2078.2 - 2140.6
  56, 2156.75f, //2140.7 - 2171.8
  57, 2205.75f, //2171.9 - 2234.3
  58, 2257.5f,  //2234.4 - 2296.8
  59, 2311.75f, //2296.9 - 2328.1
  60, 2369.0f,  //2328.2 - 2390.6
  61, 2409.25f, //2390.7 - 2421.8
  62, 2461.5f,  //2421.9 - 2484.3
  63, 2516.25f, //2484.4 - 2546.8
  64, 2573.5f,  //2546.9 - 2609.3
  65, 2633.75f, //2609.4 - 2671.8
  66, 2697.0f,  //2671.9 - 2734.3
  67, 2763.75f, //2734.4 - 2796.8
  68, 2813.25f, //2796.9 - 2859.3
  69, 2875.5f,  //2859.4 - 2921.8
  70, 2941.25f, //2921.9 - 2984.3
  71, 3010.0f,  //2984.4 - 3046.8
  72, 3082.25f  //3046.9 - 3109.3
};


//////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
float two_tone_get_freq( int idx )
{

  if( idx < 1 ) return 0.0f;
  if( idx > 72 ) return 0.0f;

  two_tone_table *rec;
  rec = ( two_tone_table * ) &two_tones[idx - 1];
  return rec->tone_freq_hz;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// find closest idx value for the measured frequency
//
// Returns:  -1 if frequency is out of range
//           1-72 are valid range for tone index as defined for G4/G5 pagers in QCII document, Figure 2.
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
int two_tone_get_idx( float measured_freq_hz )
{

  if( measured_freq_hz < 265.0f ) return -1;
  if( measured_freq_hz > 3110.0f ) return -1;

  two_tone_table *rec;

  int idx = -1;
  float min_diff = 100.0f;
  for( int i = 0; i < 72; i++ ) {
    rec = ( two_tone_table * ) &two_tones[i];
    if( fabs( rec->tone_freq_hz - measured_freq_hz ) < min_diff ) {
      min_diff = fabs( rec->tone_freq_hz - measured_freq_hz );
      idx = rec->tone_idx;
    }
  }

  return idx;
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
void process_tone_pair_qcii( int TONE_A, int TONE_B )
{
}
